<!DOCTYPE html>
<html>
<head>
  <title>Karen Parking Radar ğŸš¨</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { margin:0; font-family:sans-serif; }
    #map { height: 50vh; }
    #dashboard { padding:10px; text-align:center; background:#fff; }
    #threat {
      font-size: 1.5em;
      font-weight: bold;
      color: red;
      display: inline-block;
      transition: transform 0.3s ease, color 0.3s ease;
    }
    .pulse {
      transform: scale(1.5);
      color: darkred;
    }
  </style>
</head>
<body>
  <div id="dashboard">
    Monitoring <b>ZIP 77018</b> for parking complaintsâ€¦<br>
    Karen Threat Level: <span id="threat">0</span> âš ï¸
  </div>
  <div id="map"></div>

  <script>
    const map = L.map('map').setView([29.8078, -95.4250], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const apiURL = "https://data.houstontx.gov/resource/7x3i-zuj1.json?$limit=1000";

    let seen = new Set(JSON.parse(localStorage.getItem('seenComplaints') || '[]'));
    let threatLevel = seen.size;
    const threatSpan = document.getElementById('threat');
    threatSpan.textContent = threatLevel;

    const sarcasticComments = [
      "Someoneâ€™s really committed to their civic dutyâ€¦",
      "Oh look, a new neighbor report!",
      "Brace yourself, the HOA might callâ€¦",
      "Drama levels rising!",
      "Someone woke up with a parking complaint today."
    ];

    function animateThreat() {
      threatSpan.classList.add('pulse');
      setTimeout(() => threatSpan.classList.remove('pulse'), 500);
    }

    function updateRadar() {
      fetch(apiURL)
        .then(res => res.json())
        .then(data => {
          // Filter for ZIP 77018 and parking only
          const zipParking = data.filter(f =>
            f.zip && f.zip === "77018" &&
            f.sr_type && f.sr_type.toLowerCase().includes("parking")
          );

          zipParking.forEach(f => {
            const id = f.service_request_id || f.sr_number || f.created_date;
            if (!seen.has(id)) {
              seen.add(id);
              localStorage.setItem('seenComplaints', JSON.stringify([...seen]));

              threatLevel++;
              threatSpan.textContent = threatLevel;
              animateThreat();

              const lat = parseFloat(f.latitude) || 29.8078;
              const lon = parseFloat(f.longitude) || -95.4250;

              const comment = sarcasticComments[Math.floor(Math.random() * sarcasticComments.length)];

              L.circleMarker([lat, lon], {radius:8, color:'red', fillOpacity:0.7})
                .addTo(map)
                .bindPopup(`<b>ğŸš¨ ${f.sr_type} ğŸš¨</b><br>Status: ${f.status || "Unknown"}<br>Reported: ${f.created_date || ""}<br><i>${comment}</i>`);

              console.log("New parking complaint in 77018:", f.address, f.sr_type, f.created_date);
              alert("ğŸš¨ KAREN ALERT! New parking complaint detected! ğŸš¨");
            }
          });
        })
        .catch(err => console.error("API Error:", err));
    }

    setInterval(updateRadar, 30000);
    updateRadar();
  </script>
</body>
</html>



