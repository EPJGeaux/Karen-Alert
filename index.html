<!DOCTYPE html>
<html>
<head>
  <title>Houston Karen Command Center</title>
  <meta charset="utf-8" />

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: sans-serif;
  }

  #map {
    height: 100%;
    width: 100%;
  }

  #controls {
    position: absolute;
    top: 15px;
    right: 15px;
    background: white;
    padding: 12px 14px;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    z-index: 1000;
    line-height: 1.6;
    font-size: 14px;
  }

  #controls label {
    display: block;
    cursor: pointer;
    white-space: nowrap;
  }

  #title {
    position: absolute;
    bottom: 15px;
    left: 15px;
    background: rgba(0,0,0,0.65);
    color: white;
    padding: 8px 12px;
    border-radius: 12px;
    font-size: 13px;
    z-index: 1000;
  }
</style>



   
</head>

<body>

<div id="controls">
  <strong>311 Chaos Filters</strong>
  <label><input type="checkbox" value="parking" checked> ðŸš— Parking Drama</label>
  <label><input type="checkbox" value="trash" checked> ðŸ—‘ Trash Crimes</label>
  <label><input type="checkbox" value="noise" checked> ðŸ”Š Noise Meltdowns</label>
  <label><input type="checkbox" value="other" checked> ðŸŒª Other Chaos</label>
</div>

<div id="title">Houston Karen Command Center</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const apiURL =
    "https://mycity2.houstontx.gov/pubgis01/rest/services/311/Houston311_RecentServiceRequests/FeatureServer/3/query?where=1%3D1&outFields=CaseType,Status,Latitude,Longitude,IncidentAddress&resultRecordCount=500&f=json";

  const map = L.map("map").setView([29.7604, -95.3698], 11);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Houston Chaos Engine"
  }).addTo(map);

  let markers = [];
  let cached = [];

  function getFilters() {
    return new Set(
      [...document.querySelectorAll("#controls input:checked")]
        .map(cb => cb.value)
    );
  }

  function matches(caseType, filters) {
    const type = (caseType || "").toLowerCase();

    if (type.includes("parking")) return filters.has("parking");
    if (type.includes("trash")) return filters.has("trash");
    if (type.includes("noise")) return filters.has("noise");

    return filters.has("other");
  }

  function clearMarkers() {
    markers.forEach(m => map.removeLayer(m));
    markers = [];
  }

  function render() {
    clearMarkers();
    const filters = getFilters();

    cached.forEach(attrs => {
      const lat = attrs.Latitude;
      const lon = attrs.Longitude;

      if (!lat || !lon) return;
      if (!matches(attrs.CaseType, filters)) return;

      const marker = L.circleMarker([lat, lon], { radius: 6 })
        .addTo(map)
        .bindPopup(`
          <b>${attrs.CaseType || "Unknown Chaos"}</b><br>
          Status: ${attrs.Status || "Unknown"}<br>
          ${attrs.IncidentAddress || ""}
        `);

      markers.push(marker);
    });

    console.

    
